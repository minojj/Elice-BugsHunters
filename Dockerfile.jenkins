FROM jenkins/jenkins:lts

USER root

RUN set -eux; \
    apt-get update; \
    apt-get install -y --no-install-recommends \
        ca-certificates \
        curl \
        git \
        python3 \
        python3-pip \
    ; \
    rm -rf /var/lib/apt/lists/*; \
    \
    # ğŸ³ docker CLI (ì •ì  ë°”ì´ë„ˆë¦¬) ì„¤ì¹˜ - ì•„í‚¤í…ì²˜ì— ë§ê²Œ
    mkdir -p /usr/bin; \
    ARCH="$(uname -m)"; \
    case "$ARCH" in \
      x86_64|amd64)   DOCKER_ARCH="x86_64" ;; \
      aarch64|arm64)  DOCKER_ARCH="aarch64" ;; \
      *) echo "Unsupported arch: $ARCH" && exit 1 ;; \
    esac; \
    curl -fsSL "https://download.docker.com/linux/static/stable/${DOCKER_ARCH}/docker-26.1.4.tgz" \
      | tar -xz -C /usr/bin --strip-components=1 docker/docker; \
    /usr/bin/docker --version; \
    \
    # ğŸ python í¸ì˜ ë§í¬ + Jira ìŠ¤í¬ë¦½íŠ¸ìš© íŒ¨í‚¤ì§€ ì„¤ì¹˜
    ln -sf /usr/bin/python3 /usr/bin/python; \
    pip3 install --no-cache-dir --break-system-packages requests jira

# Jenkinsì—ì„œ host docker.sock ì‚¬ìš©
ENV DOCKER_HOST=unix:///var/run/docker.sock

USER jenkins
